geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_fill_manual(values=hcl(seq(15,375,length.out=5)[1:4],100,70))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3)
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_fill_manual(values=hcl(seq(15,375,length.out=5)[1:4],100,70)) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100,40),"black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3)
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3)
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100,40),"black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100),"black", "black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100),"red", "black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100, 100),"red", "black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100, 100),"black", "black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100, 40),"black", "black"))
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_fill_manual(values=hcl(seq(15,375,length.out=5)[1:4],100,70)) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100,40),"black")) +
scale_y_continuous(limits=c(-1,20), breaks=0:20)
dat
dat.m
dat = data.frame(Subject = 1:10,
Months = sample(4:20, 10, replace=TRUE),
Treated=sample(0:1, 10, replace=TRUE),
Stage = sample(1:4, 10, replace=TRUE),
Continued=sample(0:1, 10, replace=TRUE))
dat
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8)
ggplot(dat, aes(Subject, Months)) +
geom_bar(stat="identity", aes(fill=factor(Stage)), width=0.8) +
geom_point(data=dat.m,
aes(Subject, value, colour=variable, shape=variable), size=4) +
geom_segment(data=dat %>% filter(Continued==1),
aes(x=Subject, xend=Subject, y=Months + 0.1, yend=Months + 1),
pch=15, size=0.8, arrow=arrow(type="closed", length=unit(0.1,"in"))) +
coord_flip() +
geom_hline(yintercept=3) +
scale_fill_manual(values=hcl(seq(15,375,length.out=5)[1:4],100,70)) +
scale_colour_manual(values=c(hcl(seq(15,375,length.out=3)[1:2],100,40),"black")) +
scale_y_continuous(limits=c(-1,20), breaks=0:20) +
labs(fill="Disease Stage", colour="", shape="",
x="Subject Recevied Study Drug") +
theme_bw() +
theme(panel.grid.minor=element_blank(),
panel.grid.major=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())
q()
q()
library(data.table)
install.packages("jsonlite")
install.packages(c("dplyr", "purrr", "tidytext"))
install.packages(c("syuzhet", "DT", "randomForest"))
library(data.table)
install.packages(c("data.table", "tibble"))
install.packages(c("tidry", "lubridate"))
q()
92058.46+98458.09 + 11685.20
0.46 + 0.09 + 0.20
92058+98458+11685
202201.75 + 17.13
75+13
options(digits=2)
202201.75 + 17.13
options(digits=10)
202201.75 + 17.13
830.84 + 7257.23 + 6662.12
14750.19 + 5607.49
20357.68 + 5459.62 + 1800
202218.88 - 27617.3
4050*3
174601.58 - 12150
162451.58 * 0.28 - 13014.50
174601.58 + 27617.3
27617.30
27167.3 * 0.8
202218.88
202218.88 - 83800
202218.88 - 159700
42518.88 * 0.25
118418.88 + 10629.72
129048.6 * 0.26
174601.58 + 20357.68
194959.26 - 159700
35259.26 * 0.25
83800 - 8814.82
194959.26 - 74985.18
119974.08 * 0.26
2075*12
24900+375
11685.20 + 92058.46
202218.88 - 110000
93000 * 0.05
32471.94 - 600
407.99 + 10600.89 + 21258.46
32267.34 - 31871.94
202218.88 - 1800
27617.30 - 14750.19
200418.88 - 12867.11
37551.77 * 0.05
1877.5885 + 7072.50
187551.77 * 0.032
8950.09 + 6001.66
14951.75 - 14750.19
q()
q()
q()
q()
q()
q()
text <- c("Because I could not stop for Death -",
"He kindly stopped for me -",
"The Carriage held but just Ourselves -",
"and Immortality")
text
library(dplyr)
library(ggplot2)
text_df <- data_frame(line = 1:4, text = text)
library(tidytext)
text_df %>%
unnest_tokens(word, text)
test_df
text_df
library(janeaustenr)
#library(dplyr)
library(stringr)
?austen_books
a <- austen_books()
str(a)
a
head(a)
a[500:550,]
a <- austen_books() %>% group_by(book)
str(a)
a
?row_number()
?cumsum
?row_number()
?cumsum
a <- austen_books()
str(a)
b <- a[1:100, ]
b
b[50:55,]
g <- mutate(b, cha = str_detect(text, regex("^chapter [\\divxlc]", ignore_case = TRUE)))
g
?regex
g <- mutate(b, cha = str_detect(text, regex("^chapter [ivxlc]", ignore_case = TRUE)))
g
g <- mutate(b, cha = str_detect(text, regex("^chapter [\\d]", ignore_case = TRUE)))
g
g <- mutate(b, cha = cumsum(str_detect(text, regex("^chapter [\\d]", ignore_case = TRUE))))
g
g[1:20,]
?ungroup
original_books <- austen_books() %>%
group_by(book) %>%
mutate(linenumber = row_number(),
chapter = cumsum(str_detect(text, regex("^chapter [\\divxlc]",
ignore_case = TRUE)))) %>%
ungroup()
original_books
tidy_books <- original_books %>%
unnest_tokens(word, text)
str(tidy_books)
tidy_books
?anti_join
data("stop_words")
tidy_books <- tidy_books %>%
anti_join(stop_words)
tidy_books
?count
tidy_books %>%
count(word, sort = TRUE)
?reorder
tidy_books %>%
count(word, sort = TRUE) %>%
filter(n > 600) %>%
mutate(word = reorder(word, n)) %>%
ggplot(aes(word, n)) +
geom_col() +
xlab(NULL) +
coord_flip()
q()
library(tidytext)
sentiments
get_sentiments("afinn")
get_sentiments("bing")
get_sentiments("nrc")
q()
library(h2o)
q()
q()
q()
packages <- c("jsonlite", "dplyr", "purrr", "tidytext", "ggplot2", "lubridate")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
if (Sys.info()[1] == 'Windows'){
setwd('C:/Users/alin/Documents/SelfStudy/MyLearning/Kaggle/TwoSigma/data')
}else{
setwd('/home/alin/MyLearning/Kaggle/TwoSigma/data')
}
data <- fromJSON("train.json")
library(tidyr)
library(stringr)
feature_df <- data[c(9,7)] %>%
tibble::as_tibble(.) %>%
mutate(listing_id = unlist(listing_id))
feature_df$features <- apply(feature_df[,2], 1, function(l) tolower(paste(unlist(l), collapse = '|')))
feature_df <- feature_df %>%
transform(features = strsplit(features, '|', fixed = TRUE)) %>%
unnest(features) %>%
tibble::as_tibble(.)
df <- data_frame(a = c('pet friendly', 'pets ok', ' pet ok', 'pettion', 'no pet', 'apeta'))
df
df %>%
filter(str_detect(a, 'pet[s\\s]' ) | str_detect(a, 'pet$|pets$'))
df <- data_frame(a = c('pet friendly', 'pets ok', ' pet ok', 'pettion',
'no pet', 'apeta', 'apet'))
df %>%
filter(str_detect(a, 'pet[s\\s]' ) | str_detect(a, 'pet$|pets$'))
df %>%
filter(str_detect(a, '\\spet[s\\s]' ) | str_detect(a, 'pet$|pets$'))
df %>%
filter(str_detect(a, '\\spet[s\\s]' ) | str_detect(a, '\\s[pet$|pets$]'))
df %>%
filter(str_detect(a, '(^|\\s)pet[s\\s]' ) | str_detect(a, '\\s[pet$|pets$]'))
df %>%
filter(str_detect(a, '(^|\\s)pet(s|\\s)' ) | str_detect(a, '\\s[pet$|pets$]'))
df %>%
filter(str_detect(a, '(^|\\s)pet(s|\\s)' ))
df %>%
filter(str_detect(a, '(^|\\s)pet(s|\\s|$)' ))
df <- data_frame(a = c('pet friendly', 'pets ok', ' pet ok', 'pettion',
'no pet', 'apeta', 'apet', 'petsg'))
df %>%
filter(str_detect(a, '(^|\\s)pet(s|\\s|$)' ))
df %>%
filter(str_detect(a, '(^|\\s)pet(s$|s\\s|\\s|$)' ))
df <- data_frame(a = c('pet friendly', 'pets ok', ' pet ok', 'pettion',
'no pet', 'apeta', 'apet', 'petsg',
'cat friendly', 'dogs ok', ' cat ok', 'lcatg do',
' no dog', 'ldog', 'acat', 'lcatdog'))
df %>%
filter(str_detect(a, '(^|\\s)pet(s$|s\\s|\\s|$)' ))
df %>%
filter(str_detect(a, '(^|\\s)(pet|cat)(s$|s\\s|\\s|$)' ))
df %>%
filter(str_detect(a, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' ))
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' ))
pet_df
a <- unique(pet_df$features)
length(a)
a
pet1_df <- feature_df %>%
filter(str_detect(features, "pet|cat|dog"))
nrow(pet_df)
nrow(pet1_df)
b <- unique(pet1_df$features)
length(b)
length(a)
d <- setdiff(b,a)
d
a
nrow(pet_df)
nrow(feature_df)
x <- 3 >2
x
as.intger(x)
as.integer(x)
x <- 3 <2
as.integer(x)
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' ))
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s')))
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s')))
pet_df
a <- pet_df %>%
filter(pet == -1)
a
unique(a$features)
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)')))
pet_df
a <- pet_df %>%
%>%(pet == -1)
a <- pet_df %>%
filter(pet == -1)
a
unique(a$features)
b <- pet_df %>%
filter(pet == 1)
unique(b$features)
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)')))
select(listing_id, pet)
names(feature_df)
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)'))) %>%
select(listing_id, pet)
pet_df
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)'))) %>%
select(listing_id, pet) %>%
group_by(listing_id) %>%
mutate(pet1 = max(pet))
pet_df
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)'))) %>%
select(listing_id, pet) %>%
group_by(listing_id) %>%
mutate(pet1 = max(pet)) %>%
ungroup
pet_df
pet_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)'))) %>%
select(listing_id, pet) %>%
group_by(listing_id) %>%
summarise(pet = max(pet))
pet_df
pet1_df <- feature_df %>%
filter(str_detect(features, '(^|\\s)(pet|cat|dog)(s$|s\\s|\\s|$)' )) %>%
mutate(pet = 1 - 2* as.integer(str_detect(features, '(^|\\s)no\\s+(pet|cat|dog)'))) %>%
select(listing_id, pet)
pet1_df %>%
filter(listing_id == 6811965)
a <- pet_df %>%
filter(pet == -1)
a
b <- pet1_df %>%
filter(pet == -1)
b
b %>%
group_by(listing_id) %>%
count(pet, sort = TRUE)
b <- pet1_df %>%
group_by(listing_id) %>%
count(pet, sort = True) %>%
filter( n == 2)
b <- pet1_df %>%
group_by(listing_id) %>%
count(pet, sort = TRUE) %>%
filter( n == 2)
b
b <- pet1_df %>%
filter(pet == -1 ) %>%
group_by(listing_id) %>%
count(pet, sort = TRUE) %>%
filter( n == 2)
b
a <- pet_df %>%
filter(pet == -1)
a
b <- pet1_df %>%
filter(pet == -1 )
b
d <- b %>%
group_by(listing_id) %>%
count(pet, sort = TRUE)
d
d <- b %>%
group_by(listing_id) %>%
count(pet, sort = TRUE) %>%
summarise(cnt = sum(n))
d
d[1:71,]
a
b
x <- b$listing_id
length(x)
length(unique(x))
y <- a$listing_id
z <- setdiff(x,y)
z
b <- pet1_df %>%
filter(listing_id == 7027760 )
b
b <- feature_df %>%
filter(listing_id == 7027760 )
b
raw_features <- data[c(9,7)] %>%
tibble::as_tibble(.) %>%
mutate(listing_id = unlist(listing_id))
raw_features %>%
filter(listing_id == 7027760)
x <- raw_features %>%
filter(listing_id == 7027760)
x
x$features
?left_join
x <-df %>%
left_join(df1, by = id)
x <-df %>%
left_join(df1)
df <- data_frame(id = c(1,2,3,4,5), a = c(1,2,3,4,5))
df1 <- data_frame(id = c(1,2,3), b = c(1,2,3))
x <-df %>%
left_join(df1)
x
x <- x %>%
mutate(b = if (is.na(b)) 0 else b)
x
x$b1 <- apply(x, 1, function(g) if (is.na(g)) 0 else g )
q()
