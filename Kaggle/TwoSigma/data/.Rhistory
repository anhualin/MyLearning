packages <- c("jsonlite", "dplyr", "purrr", "tidytext", "ggplot2", "lubridate")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
#setwd('C:/Users/alin/Documents/SelfStudy/MyLearning/Kaggle/TwoSigma/data')
setwd('/home/alin/MyLearning/Kaggle/TwoSigma/data')
data <- fromJSON("train.json")
# unlist every variable except `photos` and `features` and convert to tibble
vars <- setdiff(names(data), c("photos", "features"))
#library(tibble)?
#library(purrr)
train_df <- map_at(data, vars, unlist) %>%
tibble::as_tibble(.) %>%
mutate(interest_level = factor(interest_level, c("low", "medium", "high")))
library(stringr)
train0 <- train_df[1:500, c('listing_id', 'description')]
dejunk <- function(a){
a <- gsub('<a\\s+website_redacted', '',a)
a <- gsub('<\\S+\\s*/*>', ' ', a)
a <- gsub('\\S+\\s*@\\s*\\S+', ' ', a)
a <- gsub('\\d+[-]*\\d+[-]\\d+', ' ', a)
a <- gsub('\\W+', ' ', a)
a <- tolower(a)
}
train0$description1 <- unlist(train0 %>% select(description) %>% map(dejunk))
train0$description <- NULL
train0$description1[100]
gsub('[[:digit:]]', ' ' , 'ab 123x a' )
train0 <- train_df[1:500, c('listing_id', 'description')]
dejunk <- function(a){
a <- gsub('<a\\s+website_redacted', '',a)
a <- gsub('<\\S+\\s*/*>', ' ', a)
a <- gsub('\\S+\\s*@\\s*\\S+', ' ', a)
a <- gsub('\\d+[-]*\\d+[-]\\d+', ' ', a)
a <- gsub('\\W+', ' ', a)
a <- gsub('[[:digit:]]', ' ', a)
a <- tolower(a)
}
train0$description1 <- unlist(train0 %>% select(description) %>% map(dejunk))
train0$description <- NULL
train0$description1[100]
train1 <- train0 %>%
unnest_tokens(word, description1)
nrow(train1)
train1[1:10,]
train2 <- train0 %>%
unnest_tokens(word, description1) %>%
filter(str_detect(word, "[a-z']$"),
!word %in% stop_words$word)
train2[1:10,]
word_cnt <- train2 %>%
count(listing_id)
nrow(word_cnt)
word_cnt[1:100]
word_cnt[1:100,]
train1[1,]
train0[train0$listing_id == 7087718,]
train0[train0$listing_id == 7087718, 'description1']
train_df[train_df$listing_id == 7087718, 'description']
pull <- function(x,y) {
x[,if(is.name(substitute(y))) deparse(substitute(y)) else y, drop = FALSE][[1]]
}
a <- train2 %>% pull('listing_id')
a <- unique(train2 %>% pull('listing_id'))
a
length(a)
nrow(word_cnt)
a <- unique(train0 %>% pull('listing_id'))
length(a)
a <- unique(train1 %>% pull('listing_id'))
length(a)
a0 <- unique(train0 %>% pull('listing_id'))
a0
a1
a
class(a)
class(a0)
is.list(a)
is.vector(a)
is.vector(a0)
length(a0)
a0 - a
b <- setdiff(a0, a)
b
train0[train0$listing_id == 7152345, 'description1']
trainx <- train_df[1:500, c('listing_id', 'description')]
trainx[trainx$listing_id == 7152345, 'description']
train_df[train_df$listing_id == 7152345, 'description']
a0[1]
train_df[train_df$listing_id == 7170325, 'description']
a[8]
train_df[train_df$listing_id == 7114138, 'description']
q()
